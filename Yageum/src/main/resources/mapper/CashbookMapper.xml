<?xml version="1.0" encoding="UTF-8"?>

<!-- https://mybatis.org/mybatis-3/getting-started.html
src/main/resources/mapper폴더/MemberMapper.xml파일 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yageum.mapper.CashbookMapper">

	<select id="getExpenseDetailById" resultType="com.yageum.domain.ExpenseDTO">
		select e.expense_sum, e.expense_memo, e.expense_date, e.expense_content, e.expense_type,
			   m.method_type, cs.cs_name, cm.cm_name, c.card_name, ba.account_name, b.bank_name,
			   e.method_in, cs.cs_in, cs.cm_in, e.card_in, e.account_in, b.bank_in, e.expense_in,
			   e.member_in
		from expense e
		left join ex_method m on e.method_in = m.method_in
		left join category_sub cs on e.cs_in = cs.cs_in
		left join category_main cm on cs.cm_in = cm.cm_in 
		left join card c on c.card_in = e.card_in 
		left join bank_account ba on e.account_in = ba.account_in 
		left join bank b on b.bank_in = ba.bank_in
		where e.expense_in = #{id} 
	</select>
	
	<update id="updateExpense" parameterType="com.yageum.domain.ExpenseDTO">
		update expense 
		set
			expense_in = #{expenseIn},
			member_in = #{memberIn},
			card_in = #{cardIn},
			account_in = #{accountIn},
			expense_sum = #{expenseSum},
			cs_in = #{csIn},
			expense_memo = #{expenseMemo},
			expense_date = #{expenseDate},
			expense_content = #{expenseContent},
			expense_type = #{expenseType},
			method_in = #{methodIn}
		where expense_in = #{expenseIn}
	</update>
	
	<select id="getAccountList" resultType="com.yageum.domain.ExpenseDTO">
		select ba.account_in, ba.account_num, ba.account_name, b.bank_in, b.bank_name
		from bank_account ba
		join bank b
		on ba.bank_in = b.bank_in
		where ba.member_in = #{memberIn}
	</select>
	
	<select id="getDailyIncomeExpense" resultType="map">
		select 
			expense_date, 
			sum(case when expense_type=0 then expense_sum else 0 end) as income,
			sum(case when expense_type=1 then expense_sum else 0 end) as expense
		from expense
		where member_in = #{memberIn}
		  and expense_date between #{start} and #{end}
		group by expense_date;
	</select>


</mapper>