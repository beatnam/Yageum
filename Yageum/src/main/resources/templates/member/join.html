<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Nanum+Brush+Script&family=Black+Han+Sans&display=swap"
		rel="stylesheet">
	<title>회원가입</title>
<link rel="stylesheet" href="css/join.css">
</head>

<body>
	<div class="signup-container">
		<div class="signup-header">
			<h1>야금야금 회원가입</h1>
			<p>새로운 계정을 만들고 가계부를 작성해봐요!</p>
		</div>

		<form th:action="@{/member/joinPro}" method="post" th:object="${memberForm}">
			<div class="form-row">
				<div class="form-group">
					<label for="memberId">아이디 <span class="required">*</span></label>
					<input type="text" id="memberId" name="memberId" th:field="*{memberId}" class="form-control"
						placeholder="아이디를 입력하세요" required>
					<div class="error-message" th:if="${#fields.hasErrors('memberId')}" th:errors="*{memberId}"></div>
				</div>

				<div class="form-group">
					<label for="memberName">이름 <span class="required">*</span></label>
					<input type="text" id="memberName" name="memberName" th:field="*{memberName}" class="form-control"
						placeholder="이름을 입력하세요" required>
					<div class="error-message" th:if="${#fields.hasErrors('memberName')}" th:errors="*{memberName}">
					</div>
				</div>
			</div>

			<div class="form-row">
				<div class="form-group">
					<label for="memberPasswd">비밀번호 <span class="required">*</span></label>
					<input type="password" id="memberPasswd" name="memberPasswd" th:field="*{memberPasswd}"
						class="form-control" placeholder="비밀번호를 입력하세요" required>
					<div class="error-message" th:if="${#fields.hasErrors('memberPasswd')}" th:errors="*{memberPasswd}">
					</div>
				</div>

				<div class="form-group">
					<label for="memberPassWd2">비밀번호 확인 <span class="required">*</span></label>
					<input type="password" id="memberPassWd2" name="memberPassWd2" th:field="*{memberPassWd2}"
						class="form-control" placeholder="비밀번호를 다시 입력하세요" required>
					<div class="password-match" id="passwordMatch"></div>
					<div class="error-message" th:if="${#fields.hasErrors('memberPassWd2')}"
						th:errors="*{memberPassWd2}"></div>
				</div>
			</div>

			<div class="form-row">
				<div class="form-group">
					<label for="memberBirth">생년월일</label>
					<input type="date" id="memberBirth" name="memberBirth" th:field="*{memberBirth}"
						class="form-control">
					<div class="error-message" th:if="${#fields.hasErrors('memberBirth')}" th:errors="*{memberBirth}">
					</div>
				</div>

				<div class="form-group">
					<label for="memberPhone">휴대폰 번호</label>
					<input type="tel" id="memberPhone" name="memberPhone" th:field="*{memberPhone}" class="form-control"
						placeholder="010-1234-5678">
					<div class="error-message" th:if="${#fields.hasErrors('memberPhone')}" th:errors="*{memberPhone}">
					</div>
				</div>
			</div>

			<div class="form-group full-width">
				<label for="memberEmail">이메일 <span class="required">*</span></label>
				<input type="email" id="memberEmail" name="memberEmail" th:field="*{memberEmail}" class="form-control"
					placeholder="example@email.com" required>
				<div class="error-message" th:if="${#fields.hasErrors('memberEmail')}" th:errors="*{memberEmail}"></div>
			</div>

			<div class="form-group full-width">
				<label>성별</label>
				<div class="radio-group">
					<div class="radio-item">
						<input type="radio" id="genderMale" name="memberGender" value="M" th:field="*{memberGender}">
						<label for="genderMale">남성</label>
					</div>
					<div class="radio-item">
						<input type="radio" id="genderFemale" name="memberGender" value="F" th:field="*{memberGender}">
						<label for="genderFemale">여성</label>
					</div>
					<div class="radio-item">
						<input type="radio" id="genderOther" name="memberGender" value="O" th:field="*{memberGender}">
						<label for="genderOther">기타</label>
					</div>
				</div>
				<div class="error-message" th:if="${#fields.hasErrors('memberGender')}" th:errors="*{memberGender}">
				</div>
			</div>

			<div class="form-group full-width">
				<label for="memberAddress">주소</label>
				<input type="text" id="memberAddress" name="memberAddress" th:field="*{memberAddress}"
					class="form-control" placeholder="주소를 입력하세요">
				<div class="error-message" th:if="${#fields.hasErrors('memberAddress')}" th:errors="*{memberAddress}">
				</div>
			</div>

			<!-- 전체 폼 에러 메시지 -->
			<div class="error-message" th:if="${signupError}" th:text="${signupError}"></div>

			<button type="submit" class="btn-signup">회원가입</button>
		</form>

		<div class="links">
			<a href="#" th:href="@{/login}">이미 계정이 있으신가요? 로그인</a>
		</div>
	</div>

	<script>
		// 비밀번호 확인 검사
		function checkPasswordMatch() {
			const password = document.getElementById('memberPasswd').value;
			const confirmPassword = document.getElementById('memberPassWd2').value;
			const matchElement = document.getElementById('passwordMatch');

			if (confirmPassword === '') {
				matchElement.textContent = '';
				matchElement.className = 'password-match';
				return;
			}

			if (password === confirmPassword) {
				matchElement.textContent = '✓ 비밀번호가 일치합니다';
				matchElement.className = 'password-match match';
			} else {
				matchElement.textContent = '✗ 비밀번호가 일치하지 않습니다';
				matchElement.className = 'password-match no-match';
			}
		}

		// 비밀번호 필드에 이벤트 리스너 추가
		document.getElementById('memberPasswd').addEventListener('input', checkPasswordMatch);
		document.getElementById('memberPassWd2').addEventListener('input', checkPasswordMatch);

		// 휴대폰 번호 자동 포맷팅
		document.getElementById('memberPhone').addEventListener('input', function (e) {
			let value = e.target.value.replace(/[^0-9]/g, '');
			if (value.length >= 4 && value.length <= 7) {
				value = value.replace(/(\d{3})(\d+)/, '$1-$2');
			} else if (value.length >= 8) {
				value = value.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3');
			}
			e.target.value = value;
		});

		// 폼 제출 시 유효성 검사
		document.querySelector('form').addEventListener('submit', function (e) {
			const password = document.getElementById('memberPasswd').value;
			const confirmPassword = document.getElementById('memberPassWd2').value;

			if (password !== confirmPassword) {
				e.preventDefault();
				alert('비밀번호가 일치하지 않습니다.');
				return false;
			}

			// 필수 필드 검사
			const requiredFields = ['memberId', 'memberName', 'memberPasswd', 'memberEmail'];
			for (let field of requiredFields) {
				if (!document.getElementById(field).value.trim()) {
					e.preventDefault();
					alert('필수 항목을 모두 입력해주세요.');
					return false;
				}
			}

			// 이메일 형식 검사
			const email = document.getElementById('memberEmail').value;
			const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			if (!emailRegex.test(email)) {
				e.preventDefault();
				alert('올바른 이메일 형식을 입력해주세요.');
				return false;
			}
		});

		// 입력 필드 애니메이션 효과
		document.querySelectorAll('.form-control').forEach(input => {
			input.addEventListener('focus', function () {
				this.style.transform = 'translateY(-2px)';
			});

			input.addEventListener('blur', function () {
				this.style.transform = 'translateY(0)';
			});
		});
	</script>
</body>

</html>