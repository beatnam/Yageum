<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>μΌλ³„ λ‚΄μ—­</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Nanum+Brush+Script&family=Black+Han+Sans&display=swap" rel="stylesheet">

 <link rel="stylesheet" href="../css/common.css">
 <link rel="stylesheet" href="../css/cashbook_list.css">

</head>
<body>
	<!-- ν—¤λ” -->
		<div th:replace="fragments/header :: header"></div>

    <!-- μ‚¬μ΄λ“λ°” + λ³Έλ¬Έ -->
    <div class="app-container">
       		<div th:replace="fragments/sidebar :: sidebar"></div>

            <main class="content">
            <div class="content-header">
                <h2>μΌλ³„ μμ… / μ§€μ¶</h2>
                <p>μ¤λμ μμ… / μ§€μ¶ λ‚΄μ—­μ„ ν™•μΈν•μ„Έμ”!</p>
            </div>
            <div class="content-body">
                <div class="date-navigation">
                    <button class="date-nav-btn" onclick="previousDay()">β—€</button>
                    <div class="current-date">
                        <span class="date-text" id="currentDate"><!--μ—¬κΈ°μ— ν™”λ©΄μ—μ„ λ„λ¥Έ λ‚ μ§ μ¶λ ¥λ¨--></span>
                    </div>
                    <button class="date-nav-btn" onclick="nextDay()">β–¶</button>
                </div>

				<!-- μμ… μ§€μ¶ λ¦¬μ¤νΈ -->
				<div class="transaction-list">
				    <div th:each="e : ${expenses}" class="transaction-item">
				        <div class="transaction-icon" th:text="${e.expenseType} ? 'π’Έ' : 'π’°'">π’°</div>

				        <div class="transaction-info">
				            <div class="transaction-name" th:text="${e.expenseMemo}">μ•„μ΄ν… μ΄λ¦„</div>
				            <div class="transaction-method" th:text="${e.expenseContent}">κ²°μ  μλ‹¨ λλ” μ¶μ²</div>
				        </div>

				        <div class="transaction-amount"
				             th:classappend="${e.expenseType} ? ' expense' : ' income'"
				             th:text="${e.expenseType ? '- ' + #numbers.formatInteger(e.expenseSum, 3, 'COMMA') : '+ ' + #numbers.formatInteger(e.expenseSum, 3, 'COMMA')}">
				        </div>
				    </div>
				</div>

                <!-- μΌμΌ ν•©κ³„ -->
				<div class="daily-summary">
				    <div class="summary-row">
				        <span>μμ…: <span class="income" th:text="'+' + #numbers.formatInteger(${incomeTotal}, 3, 'COMMA') + 'μ›'"></span></span>
				        <span>μ§€μ¶: <span class="expense" th:text="'-' + #numbers.formatInteger(${expenseTotal}, 3, 'COMMA') + 'μ›'"></span></span>
				        <span class="total">
				            μ”μ•΅:
				        <span class="balance" th:text="${balance >= 0 ? '+' + #numbers.formatInteger(balance, 3, 'COMMA') + 'μ›' : '-' + #numbers.formatInteger(balance * -1, 3, 'COMMA')} + 'μ›'"></span>
				        </span>
				    </div>
				</div>
				
				<!-- κ°€κ³„λ¶€ μ¶”κ°€ λ²„νΌ -->
				<div class="floating-label">κ°€κ³„λ¶€ μ¶”κ°€</div>
				<a href="/cashbook/insert" class="floating-btn">+</a>
            </div>
        </main>
    </div>

	<!--	ν‘Έν„°-->
		<div th:replace="fragments/footer :: footer"></div>

    <script>
  
		//urlμ—μ„ μΏΌλ¦¬ νλΌλ―Έν„° κ°’ λ“¤κ³ μ΄
		function getDateFromURL() {
	        const params = new URLSearchParams(window.location.search);
	        return params.get("date");
	    }

		//YYYY-MM-DD β†’ "2025λ…„ 6μ›” 15μΌ"λ΅ λ³€ν™
	    function formatDateToKorean(dateStr) {
	        const [year, month, day] = dateStr.split("-");
	        return `${year}λ…„ ${parseInt(month)}μ›” ${parseInt(day)}μΌ`;
	    }

		//λ‚ μ§ μμ—­μ— urlμ—μ„ κ°€μ§€κ³  μ¨ κ°’μ„ λ‚ μ§ ν•μ‹μΌλ΅ λ³€ν™ν•λ€λ΅ μ¶λ ¥
	    document.addEventListener("DOMContentLoaded", function () {
	        const dateStr = getDateFromURL();
	        if (dateStr) {
	            const formatted = formatDateToKorean(dateStr);
	            document.getElementById("currentDate").textContent = formatted;
	        }
			
			document.querySelectorAll('.transaction-item').forEach(item => {
			    item.addEventListener('click', () => {
			        const dateStr = getDateFromURL();  // ν„μ¬ λ‚ μ§ μΏΌλ¦¬
			        // const transactionId = item.dataset.id;
			        // μμ‹: λ‚ μ§λ§ λ„κΈ°κΈ°
			        window.location.href = `/cashbook/detail?date=${dateStr}`;
			    });
			});
			
	    });   
  
		
        function logout() {
            if(confirm('λ΅κ·Έμ•„μ›ƒ ν•μ‹κ² μµλ‹κΉ?')) {
                window.location.href = '/logout';
            }
        }

            function previousDay() {
            // μ΄μ „ λ‚ μ§λ΅ μ΄λ™ν•λ” λ΅μ§
            console.log('μ΄μ „ λ‚ μ§λ΅ μ΄λ™');
        }

        function nextDay() {
            // λ‹¤μ λ‚ μ§λ΅ μ΄λ™ν•λ” λ΅μ§
            console.log('λ‹¤μ λ‚ μ§λ΅ μ΄λ™');
        }
    </script>
</body>
</html>