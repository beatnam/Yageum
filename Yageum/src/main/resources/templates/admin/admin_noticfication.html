<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="css/admin_noticfication.css">
    <title>공지사항 관리</title>
</head>
<body>
    <div class="container">
        <!-- 사이드바 -->
        <div class="sidebar">
            <h2>관리자 페이지</h2>
            
            <div class="menu-item">
                <a href="admin_user.html" class="menu-link">사용자 관리</a>
            </div>
            
            <div class="menu-item">
                <a href="admin_state.html" class="menu-link">통계 / 리포트</a>
            </div>
            
            <div class="menu-item">
                <a href="#" class="menu-link active" onclick="toggleSubmenu(event)">사이트 설정</a>
                <div class="submenu show" id="siteSettingsSubmenu">
                    <div class="submenu-item">
                        <a href="admin_quest.html" class="submenu-link">퀘스트 관리</a>
                    </div>
                    <div class="submenu-item">
                        <a href="admin_item.html" class="submenu-link">구매항목 관리</a>
                    </div>
                    <div class="submenu-item">
                        <a href="admin_category.html" class="submenu-link">카테고리 관리</a>
                    </div>
                    <div class="submenu-item">
                        <a href="admin_noticfication.html" class="submenu-link active">공지사항 관리</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 메인 콘텐츠 -->
        <div class="main-content">
            <div class="header">
                <h1>이메일 공지사항 관리</h1>
                <button class="add-btn" onclick="openSendModal()">새 공지사항 발송</button>
            </div>

            <!-- 통계 카드 -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="totalSent">5</div>
                    <div class="stat-label">총 발송 건수</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="thisMonth">2</div>
                    <div class="stat-label">이번 달 발송</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalRecipients">1,248</div>
                    <div class="stat-label">총 수신자 수</div>
                </div>
            </div>

            <!-- 발송된 공지사항 테이블 -->
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>번호</th>
                            <th>제목</th>
                            <th>내용</th>
                            <th>발송일시</th>
                            <th>수신자</th>
                            <th>상태</th>
                        </tr>
                    </thead>
                    <tbody id="notificationTableBody">
                        <!-- 발송된 공지사항들이 여기에 표시됩니다 -->
                    </tbody>
                </table>
            </div>

            <div class="pagination">
                <span>이전</span>
                <a href="#">1</a>
                <a href="#">2</a>
                <a href="#">3</a>
                <a href="#">4</a>
                <a href="#">5</a>
                <span>다음</span>
            </div>
        </div>
    </div>

    <!-- 새 공지사항 발송 모달 -->
    <div id="sendModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>새 공지사항 발송</h3>
                <button class="close-btn" onclick="closeSendModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="emailTitle">제목</label>
                    <input type="text" id="emailTitle" placeholder="공지사항 제목을 입력하세요">
                </div>
                <div class="form-group">
                    <label for="emailContent">내용</label>
                    <textarea id="emailContent" placeholder="공지사항 내용을 입력하세요"></textarea>
                </div>
                <div class="form-group">
                    <label for="recipientGroup">수신자 그룹</label>
                    <select id="recipientGroup">
                        <option value="all">전체 회원</option>
                        <option value="premium">프리미엄 회원</option>
                        <option value="basic">일반 회원</option>
                        <option value="inactive">비활성 회원</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn" onclick="closeSendModal()">취소</button>
                <button class="confirm-btn" onclick="sendNotification()">발송하기</button>
            </div>
        </div>
    </div>

    <script>
        // 샘플 데이터
        let sentNotifications = [
            {
                id: 1,
                title: "2024년 12월 정기 점검 안내",
                content: "안녕하세요. 시스템 안정성 향상을 위한 정기 점검을 실시합니다. 점검 시간: 12월 15일 오전 2시 ~ 6시",
                sentDate: "2024-12-10",
                sentTime: "14:30",
                recipientGroup: "전체 회원",
                recipientCount: 1248
            },
            {
                id: 2,
                title: "신규 기능 업데이트 안내",
                content: "새로운 기능들이 추가되었습니다. 1. 다크모드 지원 2. 알림 설정 개선 3. 성능 최적화",
                sentDate: "2024-12-08",
                sentTime: "10:15",
                recipientGroup: "전체 회원",
                recipientCount: 1248
            },
            {
                id: 3,
                title: "개인정보 처리방침 변경 안내",
                content: "개인정보 처리방침이 일부 변경되었습니다. 변경사항을 확인해 주시기 바랍니다.",
                sentDate: "2024-12-05",
                sentTime: "16:45",
                recipientGroup: "전체 회원",
                recipientCount: 1245
            },
            {
                id: 4,
                title: "프리미엄 회원 혜택 안내",
                content: "프리미엄 회원님들을 위한 특별 혜택이 추가되었습니다. 자세한 내용은 마이페이지에서 확인하세요.",
                sentDate: "2024-12-01",
                sentTime: "11:20",
                recipientGroup: "프리미엄 회원",
                recipientCount: 156
            },
            {
                id: 5,
                title: "서비스 약관 개정 안내",
                content: "서비스 이용약관이 개정되었습니다. 주요 변경사항을 확인해 주시기 바랍니다.",
                sentDate: "2024-11-28",
                sentTime: "09:00",
                recipientGroup: "전체 회원",
                recipientCount: 1240
            }
        ];

        // 페이지 로드 시 공지사항 목록 렌더링
        document.addEventListener('DOMContentLoaded', function() {
            renderNotifications();
            updateStats();
        });

        // 사이트 설정 하위 메뉴 토글
        function toggleSubmenu(event) {
            event.preventDefault();
            const submenu = document.getElementById('siteSettingsSubmenu');
            submenu.classList.toggle('show');
        }

        function renderNotifications() {
            const tbody = document.getElementById('notificationTableBody');
            
            if (sentNotifications.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-message">발송된 공지사항이 없습니다.</td>
                    </tr>
                `;
                return;
            }

            const notificationsHTML = sentNotifications.map((notification, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>
                        <div class="notification-title">${notification.title}</div>
                    </td>
                    <td>
                        <div class="notification-content" title="${notification.content}">
                            ${notification.content}
                        </div>
                    </td>
                    <td>${notification.sentDate}<br>${notification.sentTime}</td>
                    <td>
                        <div class="recipient-info">${notification.recipientGroup}</div>
                        <div class="recipient-info">${notification.recipientCount.toLocaleString()}명</div>
                    </td>
                    <td>
                        <span class="status-badge">발송완료</span>
                    </td>
                </tr>
            `).join('');

            tbody.innerHTML = notificationsHTML;
        }

        function updateStats() {
            const totalSent = sentNotifications.length;
            const thisMonth = sentNotifications.filter(n => n.sentDate.startsWith('2024-12')).length;
            const totalRecipients = sentNotifications.reduce((sum, n) => sum + n.recipientCount, 0);

            document.getElementById('totalSent').textContent = totalSent;
            document.getElementById('thisMonth').textContent = thisMonth;
            document.getElementById('totalRecipients').textContent = totalRecipients.toLocaleString();
        }

        function openSendModal() {
            document.getElementById('sendModal').style.display = 'block';
        }

        function closeSendModal() {
            document.getElementById('sendModal').style.display = 'none';
            // 폼 초기화
            document.getElementById('emailTitle').value = '';
            document.getElementById('emailContent').value = '';
            document.getElementById('recipientGroup').value = 'all';
        }

        function sendNotification() {
            const title = document.getElementById('emailTitle').value.trim();
            const content = document.getElementById('emailContent').value.trim();
            const recipientGroup = document.getElementById('recipientGroup').value;

            if (!title || !content) {
                alert('제목과 내용을 모두 입력해주세요.');
                return;
            }

            // 수신자 수 계산 (그룹별)
            const recipientCounts = {
                'all': 1250,
                'premium': 158,
                'basic': 1092,
                'inactive': 89
            };

            const recipientGroupNames = {
                'all': '전체 회원',
                'premium': '프리미엄 회원',
                'basic': '일반 회원',
                'inactive': '비활성 회원'
            };

            // 새 공지사항 추가
            const newNotification = {
                id: sentNotifications.length + 1,
                title: title,
                content: content,
                sentDate: new Date().toISOString().split('T')[0],
                sentTime: new Date().toTimeString().substring(0, 5),
                recipientGroup: recipientGroupNames[recipientGroup],
                recipientCount: recipientCounts[recipientGroup]
            };

            sentNotifications.unshift(newNotification);
            
            // UI 업데이트
            renderNotifications();
            updateStats();
            closeSendModal();

            // 성공 메시지
            alert(`이메일 공지사항이 ${newNotification.recipientCount.toLocaleString()}명에게 발송되었습니다!`);
        }

        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            const modal = document.getElementById('sendModal');
            if (event.target === modal) {
                closeSendModal();
            }
        }
    </script>
</body>
</html>