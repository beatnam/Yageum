<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œë¹„ë¶„ì„ ì¢…í•©ê²°ê³¼</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="../css/c_analysis.css">
	<link rel="stylesheet" href="../css/common.css">

</head>
<body>
<div th:replace="fragments/header :: header"></div>
<div class="app-container">
	
	<div th:replace="fragments/c_sidebar :: c_sidebar"></div>
<input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}">



        <div class="main-wrapper">
            <div class="container">
            
                <div class="header">
				    <h1>ğŸ’° ì†Œë¹„ë¶„ì„ ì¢…í•©ê²°ê³¼</h1>
				    <p th:text="|${#dates.format(#dates.createNow(), 'yyyyë…„ MMì›”')} ê¸°ì¤€ â€¢ ê°œì¸ ì†Œë¹„ íŒ¨í„´ ë¶„ì„ ë¦¬í¬íŠ¸|">2024ë…„ 12ì›” ê¸°ì¤€ â€¢ ê°œì¸ ì†Œë¹„ íŒ¨í„´ ë¶„ì„ ë¦¬í¬íŠ¸</p>
				</div>
				
				<div class="stats-grid">
				    <div class="stat-card">
				        <div class="stat-number">
				            <span th:if="${totalExpense != 0}" th:text="${#numbers.formatCurrency(totalExpense)}">â‚©2,450,000</span>
				            <span th:unless="${totalExpense != 0}">ë°ì´í„° ì—†ìŒ</span>
				        </div>
				        <div class="stat-label">ì´ë²ˆ ë‹¬ ì´ ì§€ì¶œ</div>
				        </div>
				    <div class="stat-card">
				        <div class="stat-number">
				            <span th:if="${averageDailyExpense != 0}" th:text="${#numbers.formatCurrency(averageDailyExpense)}">â‚©98,000</span>
				            <span th:unless="${averageDailyExpense != 0}">ë°ì´í„° ì—†ìŒ</span>
				        </div>
				        <div class="stat-label">ì¼í‰ê·  ì§€ì¶œ</div>
				        </div>
				    <div class="stat-card">
				        <div class="stat-number">
				            <span th:if="${countThisMonth != 0}" th:text="${#numbers.formatInteger(countThisMonth, 0, 'COMMA')}">156</span>
				            <span th:unless="${countThisMonth != 0}">ë°ì´í„° ì—†ìŒ</span>
				        </div>
				        <div class="stat-label">ì´ ê±°ë˜ ê±´ìˆ˜</div>
				        </div>
				    <div class="stat-card">
				        <div class="stat-number">
				            <span th:if="${remainingBudget != 0}" th:text="${#numbers.formatCurrency(remainingBudget)}">â‚©750,000</span>
				            <span th:unless="${remainingBudget != 0}">ë°ì´í„° ì—†ìŒ</span>
				        </div>
				        <div class="stat-label">ì´ë²ˆ ë‹¬ ë‚¨ì€ ê¸ˆì•¡</div>
				        </div>
				</div>

                <div class="main-content">
                    <div class="chart-section">
                        <h2 class="section-title">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ</h2>
                        <div class="chart-container">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>

                    <div class="insights-section">
                        <h2 class="section-title">ğŸ’¡ ì£¼ìš” ì¸ì‚¬ì´íŠ¸</h2>
                        <div class="insight-item">
                            <div class="insight-title">ì ˆì•½ ì„±ê³µ</div>
                            <div class="insight-text">ì´ë²ˆ ë‹¬ ì‹ë¹„ ì§€ì¶œì´ ëª©í‘œ ëŒ€ë¹„ 15% ì ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
                        </div>
                        <div class="insight-item">
                            <div class="insight-title">ì§€ì¶œ íŒ¨í„´ ë³€í™”</div>
                            <div class="insight-text">ì˜¨ë¼ì¸ ì‡¼í•‘ ë¹„ì¤‘ì´ ì „ì›” ëŒ€ë¹„ 25% ì¦ê°€í–ˆìŠµë‹ˆë‹¤.</div>
                        </div>
                        <div class="insight-item">
                            <div class="insight-title">ì¶”ì²œ ê°œì„ ì‚¬í•­</div>
                            <div class="insight-text">ì¹´í˜ ì§€ì¶œì„ ì›” 50ë§Œì›ìœ¼ë¡œ ì œí•œí•˜ë©´ ì—°ê°„ 120ë§Œì› ì ˆì•½ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
                        </div>
                    </div>
                </div>

                <div class="categories-section">
                    <h2 class="section-title">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ í˜„í™©</h2>
                    <div class="category-grid">
                        <div class="category-item">
                            <div class="category-icon">ğŸ½ï¸</div>
                            <div class="category-name">ì‹ë¹„</div>
                            <div class="category-amount">â‚©680,000</div>
                        </div>
                        <div class="category-item">
                            <div class="category-icon">ğŸš—</div>
                            <div class="category-name">êµí†µë¹„</div>
                            <div class="category-amount">â‚©240,000</div>
                        </div>
                        <div class="category-item">
                            <div class="category-icon">ğŸ›ï¸</div>
                            <div class="category-name">ì‡¼í•‘</div>
                            <div class="category-amount">â‚©420,000</div>
                        </div>
                        <div class="category-item">
                            <div class="category-icon">ğŸ¬</div>
                            <div class="category-name">ë¬¸í™”ìƒí™œ</div>
                            <div class="category-amount">â‚©180,000</div>
                        </div>
                        <div class="category-item">
                            <div class="category-icon">â˜•</div>
                            <div class="category-name">ì¹´í˜</div>
                            <div class="category-amount">â‚©320,000</div>
                        </div>
                        <div class="category-item">
                            <div class="category-icon">ğŸ’Š</div>
                            <div class="category-name">ì˜ë£Œ/ê±´ê°•</div>
                            <div class="category-amount">â‚©110,000</div>
                        </div>
                    </div>
                </div>

                <div class="footer">
                    <p>ğŸ“ˆ ìŠ¤ë§ˆíŠ¸í•œ ì†Œë¹„ ê´€ë¦¬ë¡œ ë” ë‚˜ì€ ë¯¸ë˜ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
                    <p style="margin-top: 10px; font-size: 0.8rem; opacity: 0.7;">
                        ë°ì´í„° ì—…ë°ì´íŠ¸: 2024.12.31 | ë¶„ì„ ê¸°ê°„: 2024.12.01 - 2024.12.31
                    </p>
                </div>
            </div>
        </div>
</div>

	<div th:replace="fragments/footer :: footer"></div>

    <script th:inline="javascript">
	    document.querySelectorAll('.stat-card, .category-item').forEach(card => {
	        card.addEventListener('mouseenter', function() {
	            this.style.transform = 'translateY(-10px) scale(1.02)';
	        });
	        
	        card.addEventListener('mouseleave', function() {
	            this.style.transform = 'translateY(0) scale(1)';
	        });
	    });
		
	    document.querySelectorAll('.insight-item').forEach(item => {
	        item.addEventListener('click', function() {
	            this.style.backgroundColor = '#fdcb6e';
	            setTimeout(() => {
	                this.style.backgroundColor = '';
	            }, 200);
	        });
	    });
	    function logout() {
	        if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
	           window.location.href = '/logout';
	        }
	     }
	    const categoryExpenses = /*[[${categoryExpenses}]]*/ [];
	    const labels = [];
	    const data = [];
	    const backgroundColors = [];
	    const colorPalette = [
	        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
	        '#FF9F40', '#E7E9ED', '#C9CBCE', '#A7AEB8', '#868B94',
	        '#6B6B6B', '#FFD700', '#ADFF2F', '#8A2BE2', '#D2691E'
	    ];

	    categoryExpenses.forEach((item, index) => {
	        labels.push(item.categoryName);
	        data.push(Number(item.amount));
	        backgroundColors.push(colorPalette[index % colorPalette.length]);
	    });
		
	    console.log("Labels for Chart:", labels);
	    console.log("Data for Chart (amounts):", data);
	    console.log("Data length:", data.length);
	    console.log("Are all data values zero?", data.every(amount => amount === 0));
		
	    if (data.length === 0 || data.every(amount => amount === 0)) {
	        const chartContainer = document.querySelector('.chart-container');
	        if (chartContainer) {
	            chartContainer.innerHTML = '<p style="text-align:center; padding: 20px; color: #555;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì§€ì¶œì„ ê¸°ë¡í•´ì£¼ì„¸ìš”!</p>';
	            chartContainer.style.display = 'flex';
	            chartContainer.style.alignItems = 'center';
	            chartContainer.style.justifyContent = 'center';
	            chartContainer.style.minHeight = '200px';
	        }
	    } else {
	        const ctx = document.getElementById('categoryChart').getContext('2d');
	        const categoryChart = new Chart(ctx, {
	            type: 'pie',
	            data: {
	                labels: labels,
	                datasets: [{
	                    data: data,
	                    backgroundColor: backgroundColors,
	                    hoverOffset: 4
	                }]
	            },
	            options: {
	                responsive: true,
	                plugins: {
	                    legend: {
	                        position: 'right',
	                    },
	                    tooltip: {
	                        callbacks: {
	                            label: function(context) {
	                                let label = context.label || '';
	                                if (label) {
	                                    label += ': ';
	                                }
	                                const value = context.parsed;
	                                label += 'â‚©' + value.toLocaleString('ko-KR');
	                                return label;
	                            },
	                            afterLabel: function(context) {
	                                const sum = context.dataset.data.reduce((a, b) => a + b, 0);
	                                const currentValue = context.parsed;
	                                const percentage = parseFloat((currentValue / sum * 100).toFixed(1));
	                                return `(${percentage}%)`;
	                            }
	                        }
	                    }
	                }
	            }
	        });
	    }
	    function animateNumbers() {
	        document.querySelectorAll('.stat-number').forEach(element => {
	            const textContent = element.textContent;
	            let number = parseInt(textContent.replace('â‚©', '').replace(/,/g, ''));
	            if (isNaN(number) || number === 0) {
	                return;
	            }
	            let current = 0;
	            const duration = 1000;
	            let startTime = null;
	
	            function easeOutQuad(t) {
	                return t * (2 - t);
	            }
	            function animate(currentTime) {
	                if (!startTime) startTime = currentTime;
	                const progress = (currentTime - startTime) / duration;
	                const easedProgress = easeOutQuad(Math.min(progress, 1));
	                const animatedValue = Math.floor(easedProgress * number);
	                element.textContent = 'â‚©' + animatedValue.toLocaleString('ko-KR');
	
	                if (progress < 1) {
	                    requestAnimationFrame(animate);
	                } else {
	                    element.textContent = textContent;
	                }
	            }
	            requestAnimationFrame(animate);
	        });
	    }
	    window.addEventListener('load', function() {
	        animateNumbers();
	    });
    </script>
</body>
</html>