<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤í”ˆë±…í‚¹ ì—°ê²°</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Gowun+Dodum&display=swap"
		rel="stylesheet">
    <link rel="stylesheet" href="/css/my_page.css">
    <link rel="stylesheet" href="/css/my_page_openbanking.css">
	<link rel="stylesheet" href="/css/my_page_open_result.css">
</head>

<body>
    <!-- í—¤ë” -->
    <div th:replace="fragments/header :: header"></div>

    <div class="accountbook-container">
		
        <!-- ë§ˆì´í˜ì´ì§€ ì‚¬ì´ë“œë°” -->
        <div th:replace="fragments/m_sidebar :: m_sidebar"></div>

        <!-- ë³¸ë¬¸ -->
        <main class="accountbook-main-content">
			<div class="edit-header">
				<h2>ì˜¤í”ˆë±…í‚¹ ê³„ì¢Œ ì—°ê²°</h2>
				<p>ì˜¤í”ˆë±…í‚¹ ì¸ì¦ì„ í†µí•´ ë‚´ ê³„ì¢Œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
				<br>
				<h3>user_seq_no : <span th:text="${map2['user_seq_no']}"></span></h3>
					
<!--				<p>í™•ì¸ìš© access_token: <span th:text="${access_token}"></span></p>	-->
				</br>
				<div class="edit-header">
				<h2>ğŸ‘¤ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ</h2>
<!--					<h2>user_seq_no : <span th:text="${map2.user_seq_no}"></span></h2>-->
<!--					<h2>user_ci : <span th:text="${map2.user_ci}"></span></h2>-->
					<h4>user_name: <span th:text="${map2['user_name']}"></span></h4>
				</div>
				<form method="post" action="/openbanking/saveAccounts">
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
				  <div class="account-box">
				    <h2>ğŸ’¸ë“±ë¡ ê³„ì¢Œ ì¡°íšŒ</h2>
				    <p>ì´ë¦„: <strong th:text="${map2['user_name']}"></strong></p>
				    <p>ì´ ê³„ì¢Œ ìˆ˜: <strong th:text="${#lists.size(accountList)}"></strong></p>

					<ul class="account-list">
					  <li th:each="acc, iterStat : ${accountList}" class="account-card" th:attr="data-index=${iterStat.index}">
					    <label>
					      <input type="checkbox" name="selectedAccounts"
					             th:value="${acc['account_num_masked'] + ',' + acc['bank_name']}">
					      <span th:text="${acc['bank_name'] + ' - ' + acc['account_num_masked']}"></span>
					    </label>
					    <input type="text" class="account-name-input"
					           th:placeholder="'í†µì¥ ì´ë¦„ (ì˜ˆ: ìƒí™œë¹„í†µì¥ ' + ${iterStat.index + 1} + ')'">
					  </li>
					</ul>

				    <div class="btn-wrapper">
				      <button type="submit" class="submit-btn">ì„ íƒí•œ ê³„ì¢Œ ì €ì¥</button>
				    </div>
				  </div>
				</form>
        </main>
    </div>
	<script>
		document.querySelector('form').addEventListener('submit', function(e) {
		  // ê¸°ì¡´ì— name ë¶™ì€ ê±° ì œê±°
		  document.querySelectorAll('.account-name-input').forEach(input => input.removeAttribute('name'));

		  // ì²´í¬ëœ í•­ëª©ë§Œ ì°¾ì•„ì„œ ì´ë¦„ ë¶™ì—¬ì¤Œ
		  const checked = document.querySelectorAll('input[name="selectedAccounts"]:checked');
		  checked.forEach((checkbox, i) => {
		    const li = checkbox.closest('.account-card');
		    const input = li.querySelector('.account-name-input');
		    input.setAttribute('name', 'accountNames'); // nameì„ ë™ì ìœ¼ë¡œ ë¶™ì—¬ì•¼ ì„œë²„ë¡œ ì „ì†¡ë¨
		  });
		});
		
	</script>
	
</body>


</html>