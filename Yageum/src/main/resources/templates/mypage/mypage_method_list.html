<!DOCTYPE html>
<html lang="ko"  xmlns:th="http://www.thymeleaf.org"
     xmlns:sec="http://www.thymeleaf.org/extras/spring-security">>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ê³„ì¢Œ ë° ê²°ì œ ìˆ˜ë‹¨ ê´€ë¦¬</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Gowun+Dodum&display=swap"
		rel="stylesheet">
	<link rel="stylesheet" href="../css/my_page.css">
	<link rel="stylesheet" href="../css/my_page_method.css">
</head>

<body>
	<!-- í—¤ë” -->
	<div th:replace="fragments/header :: header"></div>

	
	
	<div class="accountbook-container">
		<div th:replace="fragments/m_sidebar :: m_sidebar"></div>

		<main class="accountbook-main-content">
			<h1>ê²°ì œ ìˆ˜ë‹¨ ê´€ë¦¬</h1>
			
			<!-- ë²„íŠ¼ ì˜ì—­ -->
			<div class="global-controls">
			        <button class="btn btn-edit">í¸ì§‘</button>
			        <button class="btn btn-add">ì¶”ê°€</button>
			        <button id="globalDeleteBtn" class="btn btn-delete" style="display: none;">ì‚­ì œ</button>
			        <button class="btn btn-cancel" style="display: none;">ì·¨ì†Œ</button>
		    </div>

			<!-- ê³„ì¢Œ ì„¹ì…˜ -->
			<section class="payment-section" data-section="account">
				<div class="section-header">
					<h2 class="section-title">ğŸ’° ê³„ì¢Œ</h2>
				</div>
				<ul class="payment-list">
					<li class="payment-item" th:each="account : ${accountList}" th:attr="data-id=${account.accountIn}" data-type="account">
						<div class="checkbox-container">
							<input type="checkbox" class="select-checkbox">
							<div class="payment-info">
								<div class="payment-name" th:text="${account.accountName}">í†µì¥ì´ë¦„</div>
								<div class="payment-details"
									th:text="${account.bankName + ' â€¢ ' + account.accountNum}">ì€í–‰ â€¢ ê³„ì¢Œë²ˆí˜¸</div>
							</div>
						</div>
<!--						<span class="payment-status status-active">ì‚¬ìš©ì¤‘</span>-->
					</li>
				</ul>
			</section>

			<!-- ì‹ ìš©ì¹´ë“œ ì„¹ì…˜ -->
			<section class="payment-section" data-section="credit">
				<div class="section-header">
					<h2 class="section-title">ğŸ’³ ì‹ ìš©ì¹´ë“œ</h2>
				</div>
				<ul class="payment-list">
					<li class="payment-item" th:each="card : ${cardList}" th:if="${card.methodIn == 1}" th:attr="data-id=${card.cardIn}" data-type="credit">
						<div class="checkbox-container">
							<input type="checkbox" class="select-checkbox">
							<div class="payment-info">
								<div class="payment-name" th:text="${card.cardName}">ì¹´ë“œì´ë¦„</div>
								<div class="payment-details"
								     th:text="${card.cardCompany.ccName + ' â€¢ ' + card.cardNum}">íšŒì‚¬ â€¢ ì¹´ë“œë²ˆí˜¸</div>
							</div>
						</div>
<!--						<span class="payment-status status-active">ì‚¬ìš©ì¤‘</span>-->
					</li>
				</ul>
			</section>

			<!-- ì²´í¬ì¹´ë“œ ì„¹ì…˜ -->
			<section class="payment-section" data-section="debit">
				<div class="section-header">
					<h2 class="section-title">ğŸ’´ ì²´í¬ì¹´ë“œ</h2>
				</div>
				<ul class="payment-list">
					<li class="payment-item" th:each="card : ${cardList}" th:if="${card.methodIn == 2}" th:attr="data-id=${card.cardIn}" data-type="check">
						<div class="checkbox-container">
							<input type="checkbox" class="select-checkbox">
							<div class="payment-info">
								<div class="payment-name" th:text="${card.cardName}">ì¹´ë“œì´ë¦„</div>
								<div class="payment-details"
								     th:text="${card.cardCompany.ccName + ' â€¢ ' + card.cardNum}">íšŒì‚¬ â€¢ ì¹´ë“œë²ˆí˜¸</div>
							</div>
						</div>
<!--						<span class="payment-status status-active">ì‚¬ìš©ì¤‘</span>-->
					</li>
				</ul>
			</section>
			<form id="deleteForm" method="post" action="/mypage/mdelete">
			    <input type="hidden" name="_csrf" th:value="${_csrf.token}" th:name="${_csrf.parameterName}" />
			</form>
		</main>
	</div>

	<!-- í‘¸í„° -->
	<div th:replace="fragments/footer :: footer"></div>

<script>
	document.addEventListener('DOMContentLoaded', function() {
	    const sections = document.querySelectorAll('.payment-section');
	    const editBtn = document.querySelector('.btn-edit');
	    const deleteBtn = document.querySelector('.btn-delete');
	    const addBtn = document.querySelector('.btn-add');
	    const cancelBtn = document.querySelector('.btn-cancel');

	    const allCheckboxes = document.querySelectorAll('.select-checkbox');

	    // í¸ì§‘ ëª¨ë“œ ON
	    editBtn.addEventListener('click', function () {
	        sections.forEach(section => section.classList.add('edit-mode'));
	        editBtn.style.display = 'none';
	        addBtn.style.display = 'none';
	        deleteBtn.style.display = 'inline-block';
	        cancelBtn.style.display = 'inline-block';
	        allCheckboxes.forEach(cb => cb.checked = false);
	    });

	    // í¸ì§‘ ëª¨ë“œ OFF
	    cancelBtn.addEventListener('click', function () {
	        sections.forEach(section => section.classList.remove('edit-mode'));
	        editBtn.style.display = 'inline-block';
	        addBtn.style.display = 'inline-block';
	        deleteBtn.style.display = 'none';
	        cancelBtn.style.display = 'none';
	        allCheckboxes.forEach(cb => cb.checked = false);
	    });

	    // ì¶”ê°€ ë²„íŠ¼ â†’ ê¸°ì¡´ì²˜ëŸ¼ ì´ë™
	    addBtn.addEventListener('click', function () {
	        window.location.href = '/mypage/minsert';
	    });
	});
	
	document.getElementById('globalDeleteBtn').addEventListener('click', function () {
	    const checked = document.querySelectorAll('.select-checkbox:checked');
	    if (checked.length === 0) {
	        alert("ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
	        return;
	    }

	    if (!confirm("ì„ íƒí•œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

	    const form = document.getElementById('deleteForm');

	    // ê¸°ì¡´ input ì •ë¦¬
	    while (form.children.length > 1) {
	        form.removeChild(form.lastChild);
	    }

	    // ì„ íƒ í•­ëª©ì˜ id/type ì¶”ê°€
	    checked.forEach(cb => {
	        const item = cb.closest('.payment-item');
	        const id = item.getAttribute('data-id');
	        const type = item.getAttribute('data-type');

	        const idInput = document.createElement("input");
	        idInput.type = "hidden";
	        idInput.name = "ids";
	        idInput.value = id;

	        const typeInput = document.createElement("input");
	        typeInput.type = "hidden";
	        typeInput.name = "types";
	        typeInput.value = type;

	        form.appendChild(idInput);
	        form.appendChild(typeInput);
	    });

	    form.submit();
	});
	</script>
</body>

</html>